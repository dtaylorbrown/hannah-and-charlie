---
interface MenuItem {
	label: string;
	id: string;
}

const { items = [] } = Astro.props as { items: MenuItem[] };
const menuRootId = 'side-menu';
const navId = 'side-menu-panel';
---

<div
	id={menuRootId}
	class="side-menu-root fixed left-4 top-4 z-50 flex flex-col items-start gap-3"
	data-open="false"
>
	<button
		class="menu-toggle inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold uppercase tracking-wide text-black cursor-pointer shadow-lg transition hover:bg-midnight/90 focus:outline-none focus:ring-2 focus:ring-white/60 focus:ring-offset-2 focus:ring-offset-midnight"
		type="button"
		aria-controls={navId}
		aria-expanded="false"
		data-menu-toggle
	>
		<span class="sr-only">Toggle navigation</span>
		<svg
			class="h-5 w-5"
			viewBox="0 0 24 24"
			fill="none"
			stroke="currentColor"
			stroke-width="1.5"
		>
			<path
				stroke-linecap="round"
				stroke-linejoin="round"
				d="M4 6h16M4 12h16M4 18h16"></path>
		</svg>
		<span>Menu</span>
	</button>
	<nav
		id={navId}
		class="menu-panel w-56 rounded-3xl bg-white/90 p-6 text-midnight shadow-xl backdrop-blur"
		data-menu-panel
	>
		<div class="mb-4 flex items-center justify-between">
			<p
				class="text-xs font-semibold uppercase tracking-[0.3em] text-midnight/60"
			>
				Navigate
			</p>
			<button
				type="button"
				class="rounded-full p-1 text-midnight/60 transition hover:bg-midnight/10 hover:text-midnight"
				data-menu-close
				aria-label="Close navigation"
			>
				<svg
					class="h-4 w-4"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="1.5"
				>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						d="M6 6l12 12M18 6l-12 12"></path>
				</svg>
			</button>
		</div>
		<ul
			class="flex flex-col gap-4 text-sm font-semibold uppercase tracking-wide"
		>
			{
				items.map(({ id, label }) => (
					<li>
						<a
							href={`#${id}`}
							class="inline-flex w-full items-center justify-between gap-2 rounded-full bg-white/0 px-4 py-2 transition hover:bg-midnight/10"
							data-menu-link
						>
							<span>{label}</span>
							<svg
								class="h-4 w-4"
								viewBox="0 0 20 20"
								fill="none"
								stroke="currentColor"
								stroke-width="1.5"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="m7 5 5 5-5 5"
								/>
							</svg>
						</a>
					</li>
				))
			}
		</ul>
	</nav>
</div>

<style>
	.menu-panel {
		transform: translateX(calc(-100% - 1.5rem));
		opacity: 0;
		pointer-events: none;
		transition:
			transform 0.3s ease,
			opacity 0.3s ease;
	}

	.side-menu-root[data-open="true"] .menu-panel {
		transform: translateX(0);
		opacity: 1;
		pointer-events: auto;
	}

	@media (max-width: 768px) {
		.side-menu-root {
			left: 1rem;
			top: 1rem;
		}
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}
</style>

<script is:inline>
	const menuRootId = 'side-menu';

	if (typeof window !== "undefined") {
		const root = document.getElementById(menuRootId);
		if (root) {
			const toggle = root.querySelector("[data-menu-toggle]");
			const closeButton = root.querySelector("[data-menu-close]");
			const links = Array.from(root.querySelectorAll("[data-menu-link]"));

			const setOpen = (open) => {
				root.dataset.open = open ? "true" : "false";
				toggle?.setAttribute("aria-expanded", open ? "true" : "false");
				if (open) {
					root.classList.add("menu-open");
				} else {
					root.classList.remove("menu-open");
				}
			};

			const toggleMenu = () => {
				const isOpen = root.dataset.open === "true";
				setOpen(!isOpen);
			};

			toggle?.addEventListener("click", (event) => {
				event.stopPropagation();
				toggleMenu();
			});

			closeButton?.addEventListener("click", (event) => {
				event.stopPropagation();
				setOpen(false);
			});

			links.forEach((link) =>
				link.addEventListener("click", () => {
					setOpen(false);
				}),
			);

			document.addEventListener("keydown", (event) => {
				if (event.key === "Escape") {
					setOpen(false);
				}
			});

			document.addEventListener("click", (event) => {
				if (!root.contains(event.target)) {
					setOpen(false);
				}
			});
		}
	}
</script>
